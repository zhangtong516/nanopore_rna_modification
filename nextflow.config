// Nextflow configuration file
params {
    // run params
    output_dir = "./results"
    threads = 8  // Add this line

    // params for prepare_input
    chunk_size = 4000

    // params for dorado basecaller
    min_qscore = 7
    kit_name = "SQK-RNA004"
    dorado_model = "sup"
    dorado_mods_models = "pseU_2OmeU,2OmeG,m5C_2OmeC,inosine_m6A_2OmeA"

    // tools
    dorado="/home/users/astar/gis/zhangt/scratch/nanopore_dRNA_mod/tools/dorado-1.0.2-linux-x64/bin/dorado"
    modkit="/home/users/astar/gis/zhangt/scratch/nanopore_dRNA_mod/tools/dist_modkit_v0.5.0_5120ef7/modkit"
    samtools="/home/users/astar/gis/zhangt/miniforge3/bin/samtools"
    minimap2="/home/users/astar/gis/zhangt/miniforge3/bin/samtools"

}

// Process configuration
process {
    // Default process configuration
    executor = 'slurm'
    clusterOptions = '-V --partition=normal'  // Add your actual project account
    penv = 'OpenMP'
    // errorStrategy = { task.attempt < 2 ? 'retry' : 'finish' }
    pollInterval = '30 sec'
    exitReadTimeout = "120 sec"

    // Process-specific configurations
    withName: CHUNK_FILES {
        cpus = 1
        memory = '8GB'
        time = '3h'
    }
    withName: DORADO_BASECALL {
        cpus = 4
        memory = '32 GB'
        time = '4h'
        accelerator = 1
        container = 'ontresearch/dorado:latest'
        containerOptions = '--gpus all --shm-size=8g'
        clusterOptions = '-V --partition=gpu --gres=gpu:1'  // Add your actual project account
    }

    withName: DORADO_ALIGNER {
        cpus = 16
        memory = '32 GB'
        time = '4h'
    }
    withName: MERGE_CHUNKS {
        cpus = 8
        memory = '16 GB'
        time = '4h'
    }

    withName: MODIFICATION_ANALYSIS {
        cpus = 8
        memory = '16 GB'
        time = '4h'
        container = 'ontresearch/modkit:latest'
    }
    withName: GENERATE_REPORT {
        cpus = 2
        memory = '8GB'
        time = '3h'

    }
}

// Docker configuration
docker {
    enabled = false
    runOptions = '--gpus all --shm-size=8g'
}

// Singularity configuration (alternative to Docker)
singularity {
    enabled = false
    autoMounts = true
}

// Resource limits
executor {
    queueSize = 10
    submitRateLimit = '1 sec'
}

// Reporting
report {
    enabled = true
    overwrite = true
    file = "${params.output_dir}/reports/nextflow_report.html"
}

timeline {
    enabled = true
    overwrite = true
    file = "${params.output_dir}/reports/timeline.html"
}

trace {
    enabled = true
    overwrite = true
    file = "${params.output_dir}/reports/trace.txt"
}